<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Orders</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: ui-sans-serif, system-ui; margin: 2rem; line-height: 1.35; }
      h1 { margin-bottom: 1rem; }
      table { border-collapse: collapse; width: 360px; }
      th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
      form { margin-top: 1rem; display: grid; gap: 8px; width: 360px; }
      input { padding: 6px 8px; }
      button { padding: 8px 12px; cursor: pointer; }
      .note { color: #666; font-size: 0.9rem; }
    </style>
  </head>
  <body>
    <h1>Orders</h1>

    <table>
      <thead>
        <tr><th>ID</th><th>Amount</th></tr>
      </thead>
      <tbody>
      {% for o in orders %}
        <tr><td>{{ o.id }}</td><td>{{ '%.2f'|format(o.amount) }}</td></tr>
      {% else %}
        <tr><td colspan="2" class="note">No orders yet</td></tr>
      {% endfor %}
      </tbody>
    </table>

    <form id="create-form">
      <input type="number" name="id" placeholder="Optional id">
      <input type="number" step="0.01" name="amount" placeholder="Amount" required>
      <button type="submit">Create</button>
      <div class="note">Only id and amount are stored</div>
    </form>

    <script>
      const form = document.getElementById('create-form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const payload = {};
        for (const [k, v] of fd.entries()) {
          if (v !== '') payload[k] = k === 'id' ? Number(v) : v;
        }
        const res = await fetch('/orders', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        if (res.ok) location.reload();
        else {
          const msg = await res.json().catch(() => ({}));
          alert('Failed: ' + (msg.detail ?? res.statusText));
        }
      });
    </script>
  </body>
</html>
